var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.arrayFromIterator=function(a){for(var b,c=[];!(b=a.next()).done;)c.push(b.value);return c};
$jscomp.arrayFromIterable=function(a){return a instanceof Array?a:$jscomp.arrayFromIterator($jscomp.makeIterator(a))};
var SolitaireGame=function(a){var b=this;this.gameOverCallback=a;this.props={Card:{Suits:["S","H","C","D"],Values:[10,9,8,7,6]}};this.rule={validStack:function(a,d){if(b.props.Card.Values.includes(a.value)){var c=b.isBlackSuit(a)?b.isRedSuit(d):b.isBlackSuit(d);if(d.value===a.value-1&&c)return!0}else if(b.props.Card.Suits.includes(a.value)&&a.value===d.value&&a.suit===d.suit)return!0;return!1},cardsSelection:function(a,d){for(var c=d,f=b.cardStacks[a],g=f.slice(d,f.length),h=0;h<g.length-1;h++)if(b.rule.validStack(g[h],
g[h+1]))c++;else break;return c===f.length-1?c:-1},cardPlacement:function(a){a=b.cardStacks[a];if(0===a.length)return!0;a=a[a.length-1];var c=b.getSelectedCards()[0];return b.rule.validStack(a,c)},freeCellDropRule:function(){return[null===b.freeCellCard,1===b.selectedCardIDs.length].every(function(a){return!0===a})}};this.baseCards=[].concat($jscomp.arrayFromIterable(this.props.Card.Suits.map(function(a){return[].concat($jscomp.arrayFromIterable(Array(4).fill({suit:a,value:a})),$jscomp.arrayFromIterable(b.props.Card.Values.map(function(b){return{suit:a,
value:b}})))}))).reduce(function(a,b){return a.concat(b)},[]);this.isGameOver=!1;this.closedStackIdxs=this.selectedCardIDs=this.freeCellCard=this.cardStacks=null};SolitaireGame.prototype.newGame=function(){this.isGameOver=!1;var a=0,b=this.baseCards.map(function(b){return Object.assign({},b,{id:a++})});shuffle(b);this.cardStacks=[];for(var c=0;9>c;c++)this.cardStacks.push(b.splice(0,4));console.log(this);this.freeCellCard=null;this.closedStackIdxs=[]};
SolitaireGame.prototype.select=function(a){if(this.isGameOver)return[];if(this.freeCellCard&&a===this.freeCellCard.id)return this.selectedCardIDs=[a];for(var b=[],c=0;c<this.cardStacks.length;c++){var d=this.cardStacks[c],e=d.findIndex(function(b){return b.id===a});-1!==e&&(b=this.rule.cardsSelection(c,e),b=-1<b?d.slice(e,b+1).map(function(a){return a.id}):[])}this.selectedCardIDs=Array.prototype.slice.call(b);return b};
SolitaireGame.prototype.place=function(a){var b=this;if(!this.selectedCardIDs)return!1;if(-1===a)return this.selectedCardIDs=null,!1;if(this.closedStackIdxs.includes(a)||!1===this.rule.cardPlacement(a))return!1;var c=this.cardStacks[a],d;if(this.freeCellCard&&this.selectedCardIDs[0]===this.freeCellCard.id)c.push(this.freeCellCard),this.freeCellCard=null;else{for(var e=0;e<this.cardStacks.length;e++){var f=this.cardStacks[e],g=f.findIndex(function(a){return b.selectedCardIDs.includes(a.id)});-1!==
g&&(d=f.splice(g,this.selectedCardIDs.length))}c.push.apply(c,$jscomp.arrayFromIterable(d))}this.onStackUpdated(a);return!0};
SolitaireGame.prototype.placeOnFreeCell=function(){if(!1===this.rule.freeCellDropRule())return!1;for(var a=this.selectedCardIDs[0],b=$jscomp.makeIterator(this.cardStacks),c=b.next();!c.done;c=b.next()){c=c.value;var d=c.findIndex(function(b){return b.id===a});if(-1!==d)return this.freeCellCard=c.splice(d,1)[0],console.log("placeOnFreeCell - placed cards",this.freeCellCard),!0}return!1};
SolitaireGame.prototype.onStackUpdated=function(a){var b=this.cardStacks[a];b.every(function(a){return a.value===b[0].value})&&4===b.length&&this.closedStackIdxs.push(a);this.checkWinCondition()};
SolitaireGame.prototype.checkWinCondition=function(){for(var a={},b=$jscomp.makeIterator(this.cardStacks),c=b.next();!c.done;a={stack:a.stack,bottomCard:a.bottomCard},c=b.next())if(a.stack=c.value,0!==a.stack.length)if(a.bottomCard=a.stack[0],this.props.Card.Values.includes(a.bottomCard.value)){if(a.stack.length<SolitaireGame.length||!1===a.stack.every(function(a){return function(b,c){if(0===c)return 10===b.value;var d=a.stack[c-1];return b.value===d.value-1&&b.suit!==d.suit}}(a)))return!1}else if(!1===
a.stack.every(function(a){return function(b){return b.value===a.bottomCard.value&&b.suit===a.bottomCard.suit}}(a)))return!1;if(1!==this.cardStacks.map(function(a){return a.length}).filter(function(a){return 0===a}).length)return!1;this.gameOver(!0)};SolitaireGame.prototype.gameOver=function(a){console.log("gameOver",a?"WIN":"LOSE");"function"===typeof this.gameOverCallback&&this.gameOverCallback(a)};
SolitaireGame.prototype.getSelectedCards=function(){if(null!=this.freeCellCard&&this.selectedCardIDs[0]===this.freeCellCard.id)return[this.freeCellCard];var a=[],b=Array.prototype.concat.call.apply(Array.prototype.concat,$jscomp.arrayFromIterable(this.cardStacks));b=$jscomp.makeIterator(b);for(var c=b.next();!c.done&&(c=c.value,!this.selectedCardIDs.includes(c.id)||(a.push(c),a.length!==this.selectedCardIDs.length));c=b.next());return a};
SolitaireGame.prototype.isBlackSuit=function(a){return"S"===a.suit||"C"===a.suit};SolitaireGame.prototype.isRedSuit=function(a){return"H"===a.suit||"D"===a.suit};
SolitaireGame.prototype.log=function(){console.groupCollapsed("game state");console.log("free cell",this.freeCellCard);var a=function(a){return a.suit===a.value?""+a.value:""+a.suit+a.value};console.log("card stacks",this.cardStacks.slice(0,4).map(function(b){return b.map(a).join(" ")}),this.cardStacks.slice(4).map(function(b){return b.map(a).join(" ")}));console.groupEnd()};
var isWidescreen=720<=window.innerWidth,isMobileBrowser=isUsingMobileBrowser(),SolitaireCanvas=function(a){this.canvas=a;this.canvasCtx=this.canvas.getContext("2d");this.canvas.width=1*window.innerWidth;this.canvas.height=isWidescreen?.66*window.innerHeight:.85*window.innerHeight;this.game=new SolitaireGame(this.onGameOver.bind(this));this.gameOptions={suitColor:{S:"black",H:"red",C:"black",D:"red"},valueText:{S:"\u2660\ufe0f",H:"\u2665\ufe0f",C:"\u2663\ufe0f",D:"\u2666\ufe0f",10:"10",9:"9",8:"8",
7:"7",6:"6"},freeCellPos:isWidescreen?9:4};a=isWidescreen?this.canvas.width/12:this.canvas.width/6.5;var b={x:16,y:12};this.canvasOptions={columnsPerRow:isWidescreen?10:5,cardWidth:a,cardHeight:3.5*a/2.5,cardStackOffset:28,gapWidth:10,gapHeight:20,boardPadding:b,freeCell:{x:b.x+(a+10)*this.gameOptions.freeCellPos,y:b.y},cardText:{fontSize:{emojiSymbol:isMobileBrowser?20:24,text:20},offset:{x:a/12,y:20}},style:{stackBase:{fill:{"default":void 0,closedStack:"grey"},border:"grey"},freeCell:{fill:"beige",
border:"grey"},card:{border:"black"},fontFace:"Lato"}};this.init()};SolitaireCanvas.prototype.onGameOver=function(){var a=this;this.removeAllCanvasEventListeners();setTimeout(function(){a.drawRect(0,0,a.canvas.width,a.canvas.height,"","rgba(123, 123, 123, 0.5)");a.drawText("You Win!",a.canvas.width/2,a.canvas.height/2,{fontSizePx:48,color:"black"},!0)},500)};SolitaireCanvas.prototype.init=function(){this.canvasEventListeners=[];this.initMouseControl()};
SolitaireCanvas.prototype.initMouseControl=function(){var a=this;this.pointerControl={drag:{cardIDs:null,offset:{x:0,y:0}}};this.pointerControl.drag=!1;var b=isUsingMobileBrowser();b?this.addCanvasEventListener("touchstart",function(b){b.preventDefault();b=b.changedTouches[0];var c=b.target;a.onPointerDown(b.clientX-c.offsetLeft,b.clientY-c.offsetTop)}):this.addCanvasEventListener("mousedown",function(b){a.onPointerDown(b.offsetX,b.offsetY)},{passive:!0});b?this.addCanvasEventListener("touchmove",
function(b){b=b.changedTouches[0];var c=b.target;a.onPointerMove(b.clientX-c.offsetLeft,b.clientY-c.offsetTop)},{passive:!0}):this.addCanvasEventListener("mousemove",function(b){a.onPointerMove(b.offsetX,b.offsetY)},{passive:!0});b?(b=function(b){b=b.changedTouches[0];var c=b.target;a.onPointerUp(b.clientX-c.offsetLeft,b.clientY-c.offsetTop)},this.addCanvasEventListener("touchend",b,{passive:!0}),this.addCanvasEventListener("touchcancel",b,{passive:!0})):this.addCanvasEventListener("mouseup",function(b){a.onPointerUp(b.offsetX,
b.offsetY)},{passive:!0})};
SolitaireCanvas.prototype.onPointerDown=function(a,b){var c=this,d=this.graphics.cardSprites,e=d.sort(function(a,b){return b.zIndex-a.zIndex}).filter(function(d){return c.hitTestCardSprite(a,b,d)});if(0!==e.length){var f=this.game.select(e[0].card.id);0!==f.length&&(e=d.find(function(a){return a.card.id===f[0]}),this.pointerControl.drag={cardIDs:f,offset:{x:a-e.x,y:b-e.y}},f.map(function(a){return d.find(function(b){return b.card.id===a})}).forEach(function(a){a.zIndex=++c.graphics.lastZindex}))}};
SolitaireCanvas.prototype.onPointerMove=function(a,b){var c=this;if(!1!==this.pointerControl.drag){var d=this.pointerControl.drag,e=d.offset,f=this.canvasOptions.cardStackOffset;this.getCardSpritesByIDs(d.cardIDs).forEach(function(d,h){c.moveCardTo(d,{x:a-e.x,y:b-e.y+h*f})});this.render()}};
SolitaireCanvas.prototype.onPointerUp=function(a,b){var c=this;if(!1!==this.pointerControl.drag){var d=this.graphics.cardSprites.filter(function(d){return!1===c.pointerControl.drag.cardIDs.includes(d.card.id)&&c.hitTestCardSprite(a,b,d)}).map(function(a){return a.card.id});var e=0<d.length?this.game.cardStacks.findIndex(function(a){return a.some(function(a){return d.includes(a.id)})}):this.graphics.stackPos.findIndex(function(d){return c.hitTestCardSprite(a,b,d)});if(0<=e){var f=this.game.place(e);
this.getCardSpritesByIDs(this.pointerControl.drag.cardIDs).forEach(function(a){c.game.cardStacks.forEach(function(b,d){var e=b.findIndex(function(b){return b.id===a.card.id});if(-1!==e){var f=c.graphics.stackPos[d];c.moveCardTo(a,{x:f.x,y:f.y+c.canvasOptions.cardStackOffset*e},e)}})});this.game.closedStackIdxs.includes(e)&&this.closeStack(e);!1===f&&null!==this.game.freeCellCard&&this.pointerControl.drag.cardIDs[0]===this.game.freeCellCard.id&&(e=this.graphics.cardSprites.find(function(a){return a.card.id===
c.game.freeCellCard.id}),this.moveCardTo(e,this.canvasOptions.freeCell,1))}else e=this.canvasOptions.freeCell,this.hitTestCardSprite(a,b,e)?this.game.placeOnFreeCell()&&null!==this.game.freeCellCard?(f=this.graphics.cardSprites.find(function(a){return a.card.id===c.game.freeCellCard.id}),this.moveCardTo(f,e,1)):this.resetDraggedCards(this.getCardSpritesByIDs(this.pointerControl.drag.cardIDs)):(console.log("dropped on table"),f=this.getCardSpritesByIDs(this.pointerControl.drag.cardIDs),this.game.freeCellCard&&
this.pointerControl.drag.cardIDs[0]===this.game.freeCellCard.id?this.moveCardTo(f[0],e,1):this.resetDraggedCards(f));this.game.log();this.pointerControl.drag=!1;this.render()}};SolitaireCanvas.prototype.getCardSpritesByIDs=function(a){var b=this;return a.map(function(a){return b.graphics.cardSprites.find(function(b){return b.card.id===a})})};SolitaireCanvas.prototype.moveCardTo=function(a,b,c){var d=b.y;a.x=b.x;a.y=d;"undefined"!==typeof c&&(a.zIndex=c)};
SolitaireCanvas.prototype.resetDraggedCards=function(a){var b=this,c=this.game.cardStacks.findIndex(function(a){return a.some(function(a){return b.pointerControl.drag.cardIDs.includes(a.id)})}),d=this.graphics.stackPos[c];a.map(function(a){return b.game.cardStacks[c].findIndex(function(b){return b.id===a.card.id})}).forEach(function(c,f){b.moveCardTo(a[f],{x:d.x,y:d.y+b.canvasOptions.cardStackOffset*c},c)})};
SolitaireCanvas.prototype.closeStack=function(a){var b=this;this.game.cardStacks[a].map(function(a){return a.id}).forEach(function(a){var c=b.graphics.cardSprites.findIndex(function(b){return b.card.id===a});b.graphics.cardSprites.splice(c,1)})};SolitaireCanvas.prototype.hitTestCardSprite=function(a,b,c){var d=this.canvasOptions;return isPointInRect(a,b,c.x,c.y,d.cardWidth,d.cardHeight)};SolitaireCanvas.prototype.startGame=function(){this.game.newGame();this.initGraphics()};
SolitaireCanvas.prototype.initGraphics=function(){var a=this;this.graphics={stackPos:[],cardSprites:[],lastZindex:1};var b=this.canvasOptions,c=b.cardWidth,d=b.cardHeight,e=b.gapWidth,f=b.gapHeight,g=b.cardStackOffset,h=b.boardPadding;b=b.columnsPerRow;for(var n=clamp(2.5,window.innerHeight/200,3),k={},l=0;l<this.game.cardStacks.length;k={stackPos:k.stackPos},l++){var m=l;l>=this.gameOptions.freeCellPos&&(m+=1);k.stackPos={x:h.x+m%b*(c+e),y:h.y+(d*n+f)*Math.floor(m/b)};k.stackPos.x=Math.floor(k.stackPos.x);
k.stackPos.y=Math.floor(k.stackPos.y);this.graphics.stackPos.push(k.stackPos);this.game.cardStacks[l].forEach(function(b){return function(e,f){a.graphics.cardSprites.push({card:e,x:b.stackPos.x,y:b.stackPos.y+g*f,width:c,height:d,zIndex:f})}}(k))}this.graphics.lastZindex=3;this.render()};
SolitaireCanvas.prototype.render=function(){var a=this;this.canvasCtx.clearRect(0,0,this.canvas.width,this.canvas.height);var b=this.canvasOptions,c=b.freeCell,d=b.cardWidth,e=b.cardHeight,f=b.style;b=this.graphics;var g=b.cardSprites;b.stackPos.forEach(function(b,c){a.drawRect(b.x,b.y,d,e,f.stackBase.border,a.game.closedStackIdxs.includes(c)?f.stackBase.fill.closedStack:f.stackBase.fill["default"])});this.drawRect(c.x,c.y,d,e,f.freeCell.border,f.freeCell.fill);g.filter(function(a){return 0===a.zIndex}).forEach(this.drawCardGraphic.bind(this));
g.filter(function(a){return 0<a.zIndex}).sort(function(a,b){return a.zIndex-b.zIndex}).forEach(this.drawCardGraphic.bind(this))};
SolitaireCanvas.prototype.drawCardGraphic=function(a){var b=a.card,c=a.x,d=a.y,e=a.width;a=a.height;this.canvasCtx.clearRect(c,d,e,a);this.drawRect(c,d,e,a,this.canvasOptions.style.card.border);e=this.canvasOptions.cardText;this.drawText(this.gameOptions.valueText[b.value],c+e.offset.x,d+e.offset.y,{fontSizePx:this.game.props.Card.Suits.includes(b.value)?e.fontSize.emojiSymbol:e.fontSize.text,color:this.gameOptions.suitColor[b.suit]})};
SolitaireCanvas.prototype.drawRect=function(a,b,c,d,e,f){a=Math.floor(a);b=Math.floor(b);c=Math.floor(c);d=Math.floor(d);e&&(this.canvasCtx.strokeStyle=e);this.canvasCtx.strokeRect(a,b,c,d);"undefined"!==typeof f&&(this.canvasCtx.fillStyle=f,this.canvasCtx.fillRect(a,b,c,d))};
SolitaireCanvas.prototype.drawText=function(a,b,c,d,e){var f=d.fontSizePx;d=d.color;this.canvasCtx.font=f+"px "+this.canvasOptions.style.fontFace;this.canvasCtx.fillStyle=d;(void 0===e?0:e)&&(b-=this.canvasCtx.measureText(a).width/2);this.canvasCtx.fillText(a,Math.floor(b),Math.floor(c))};SolitaireCanvas.prototype.addCanvasEventListener=function(a,b,c){this.canvasEventListeners.push({eventName:a,listener:b});this.canvas.addEventListener(a,b,c)};
SolitaireCanvas.prototype.removeAllCanvasEventListeners=function(){for(var a=$jscomp.makeIterator(this.canvasEventListeners),b=a.next();!b.done;b=a.next())b=b.value,this.canvas.removeEventListener(b.eventName,b.listener)};function shuffle(a){for(var b=0;b<a.length;b++){var c=Math.floor(Math.random()*a.length),d=Math.floor(Math.random()*a.length),e=a[c];a[c]=a[d];a[d]=e}}function isPointInRect(a,b,c,d,e,f){return c<=a&&a<=c+e&&d<=b&&b<=d+f}
function isUsingMobileBrowser(){return!(!window.navigator.userAgent.match(/Android/i)&&!window.navigator.userAgent.match(/iPhone/i))}function clamp(a,b,c){return a<b?b<c?b:c:a};